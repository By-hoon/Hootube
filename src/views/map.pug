extends base.pug
include mixins/marker

block content
    
    div(id="map" style="width:100%;height:90%;")
    
    each marker in stories
        +marker(marker)

    script.
        function mapPrint(){
            mapContainer = document.getElementById('map'),
            mapOption = { 
                center: new kakao.maps.LatLng(36.33929480377198, 127.39343696623958),
                level: 7
            };
            var map = new kakao.maps.Map(mapContainer, mapOption);
            const markerLat =  document.getElementsByClassName('markerLat');
            const markerLng =  document.getElementsByClassName('markerLng');
            const markerTitle =  document.getElementsByClassName('markerTitle');
            var imageSrc = "../uploads/avatars/5bce96c57da79d0cfa2ba5df0e8d6bdb",
                imageSize = new kakao.maps.Size(20, 20),
                imageOption = {};
            var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);
            for (var i = 0; i < markerLng.length; i ++) {
                var marker = new kakao.maps.Marker({
                    map: map,
                    position: new kakao.maps.LatLng(markerLat[i].value, markerLng[i].value),
                    image : markerImage
                });
                var infowindow = new kakao.maps.InfoWindow({
                    content: markerTitle[i].value
                });
                kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
                kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
            };
        }
        function makeOverListener(map, marker, infowindow) {
            return function() {
                infowindow.open(map, marker);
            };
        }

        function makeOutListener(infowindow) {
            return function() {
                infowindow.close();
            };
        }
        
        function init(){
            mapPrint();
        };
        init();